These are my notes for my initial rebuild of the project
there is a lot of wrong information in here
for updated final rebuild instructions checkout projectRebuild-instructions.md
-Shahmir Khan June 23, 2025

We are going to build a React-Native WebRTC app from scratch

We are going to do this in stages. In this stage we are going to create a blank expo project and build a clean project with working dependencies.

First lets create the expo project:
npx create-expo-app WebRTCApp --template blank

In a blank expo app the folder structure is very simple.

package.json - This lists all our dependencies for this project
package-lock.json - This is generated by Expo to keep track of specific versions of packages. It ensures that only packages compatible with Expo are used
app.json - This configs the app we are making
index.js - This is the page that runs, which sets the app as the root component
App.js - This describes the actual app

Since this app is supposed to be a multi-platform WebRTC app we need to setup React Native for web.

So lets first install react-native-web
https://github.com/necolas/react-native-web
https://necolas.github.io/react-native-web/docs/installation/

(Wrong Way) according to the docs we can install it using:
npm install react-dom react-native-web --save
I also added --save to the command so that it would save to my dependency list.
and the Babel plugin is recommended for build-time optimizations
npm install --save-dev babel-plugin-react-native-web

We can also install more simply it using:
npm install react-native-web

Both of these ways are incorrect for what we are trying to do.
Since we are an Expo project and Expo should be handling the versions of our dependencies, we must install using Expo:
npx expo install react-dom react-native-web

Then the Babel plugin for optimization:
npx expo install babel-plugin-react-native-web

Checking package.json shows that the dependencies have been saved.
Now lets run the app on both android and web and make sure its working:
npm start

On android emulator our app worked fine
But on web there was error:
It looks like you're trying to use web support but don't have the required dependencies installed.

Install @expo/metro-runtime@~5.0.4 by running:

npx expo install @expo/metro-runtime

So lets install metro-runtime:
npx expo install @expo/metro-runtime

Now lets try running the app again:
Great! It's working on both apps!

Now let's try to get the dependencies for WebRTC on React Native
For WebRTC on React Native we need react-native-webrtc
To get it to work on web we need to add the web shim
and to ensure this is compatible with Expo we need the config plugin and a custom build of Expo
https://github.com/react-native-webrtc/react-native-webrtc
https://github.com/react-native-webrtc/react-native-webrtc-web-shim
https://github.com/expo/config-plugins/tree/main/packages/react-native-webrtc

Let's first install react-native-webrtc:
npx expo install react-native-webrtc

Now lets install the web-shim:
npx expo install react-native-webrtc-web-shim

Now lets setup the Expo config plugin:
npx expo install react-native-webrtc @config-plugins/react-native-webrtc

After installing this npm package, add the config plugin to the plugins array of your app.json or app.config.js:
{
"plugins": ["@config-plugins/react-native-webrtc"]
}

(Wrong Way)Next, rebuild your app as described in the "Adding custom native code" guide:
https://docs.expo.dev/workflow/customizing/

Creating a local module

If you intend to use your native module in a single app (you can always change your mind later), we recommend using a "local" Expo module to write custom native code. Local Expo Modules function similarly to Expo Modules used by library developers and within the Expo SDK, like expo-camera, but they are not published on npm. Instead, you create them directly inside your project.

Creating a local module scaffolds a Swift and Kotlin module inside the modules directory in your project, and these modules are automatically linked to your app.
Terminal
npx create-expo-module@latest --local
npx expo run

I named the local module my-module with a native name of MyModule

(Local Build)This is an incorrect way of doing things, we need to be using expo-dev-client not making local modules
npx expo install expo-dev-client

1. Local Development with expo-dev-client (Custom Dev Client)
   Pros:
   Fast Refresh: You get instant code updates (hot reload) when you save files.
   Live Debugging: You can use React Native/Expo debugging tools, console logs, and error overlays.
   Native Module Support: Lets you test native code (like react-native-webrtc) in development.
   No Build Wait: You don’t have to wait for cloud builds—just run npx expo run:android or npx expo run:ios and develop locally.
   Cons:
   Initial Setup: First build takes a few minutes, but subsequent runs are fast.
   Platform Requirements: For iOS, you need a Mac.

local method:

install expo-dev-client:
npx expo install expo-dev-client

Since the default project App.js has setup light/dark modes we might need expo-system-ui:
npx expo install expo-system-ui (i didn't install this)

Build and run the custom dev client:
npx expo run:android or npx expo run:ios

Start metro bundler:
npx expo start or npm start (cuz we have start script setup)

(Cloud Build)Ok so we actually need to be using EAS to build our app 2. EAS Build (Cloud Build, Standalone App)
Pros:
Production-Ready: Builds the actual app you’ll ship to users.
No Local Native Setup: No need for Xcode/Android Studio for building (except for local dev).
Easy Distribution: Share builds with testers or upload to app stores.
Cons:
Slower Iteration: Each build takes several minutes (sometimes 5–15+), so bugfixing is much slower.
No Fast Refresh: You must rebuild and reinstall the app for every code change.
Debugging: Harder to debug—no live error overlays, and you must rely on logs or remote debugging.

EAS Cloud method:

Install EAS CLI globally:
npm install -g eas-cli

login to expo account:
eas login

Configure EAS build:
eas build:configure

Start EAS build:
eas build -p android or eas build -p ios

Ok so I have now setup a local build of Expo
I then added my typescript code to App.js and fixed it up so it would be proper javascript
I now need to add the dependencies that are in the App.js file:
@react-navigation/native
@react-navigation/stack
react-native-paper

Install these using:
npx expo install @react-navigation/native @react-navigation/stack react-native-paper

might also need?:
npx expo install react-native-screens react-native-safe-area-context (i didn't install)

App won't run because it needs LoginScreen, thats pretty simple functionality so lets add it before we test

I then added my typescript code to LoginScreen and fixed it up to be proper .jsx
I now need to add dependencies:
@react-native-async-storage/async-storage

Install using:
npx expo install @react-native-async-storage/async-storage

App still won't run
Tried rebuilding android, still won't run
tried npx react-native log-android

⚠️ react-native depends on @react-native-community/cli for cli commands. To fix update your package.json to include:

"devDependencies": {
"@react-native-community/cli": "latest",
}

so I did:
npx expo install @react-native-community/cli

log-android did not help
I restarted the server with npx run:android and opened adb logcat in another terminal
after putting the error into AI it said that my error is because I am missing react-native-gesture-handler which is needed for mobile to do navigations

to install:
npx expo install react-native-gesture-handler

This change the error to:

Exception thrown when executing UIFrameGuarded
ViewManagerResolver returned null for either RNCSafeAreaProvider or RCTRNCSafeAreaProvider, existing names are: [DebuggingOverlay, RNGestureHandlerButton, RCTSafeAreaView, RCTModalHostView, RCTTextInlinelmage, Android ProgressBar, AndroidHorizontalScrollView, RCTImageView, RCTText, Android HorizontalScrollContentView, UnimplementedNativeView, RTCVideoView, RCTScrollView, RCTView, AndroidDrawerLayout, AndroidSwitch, RCTVirtualText,
AndroidSwipeRefreshLayout, RCTRawText, AndroidTextInput, RNGestureHandlerRootView]

Why did this happen?
React Navigation and other libraries require react-native-safe-area-context for proper layout on devices with notches, rounded corners, etc.
If it’s missing, you get this error and your app may crash or not render correctly.

to install:
npx expo install react-native-safe-area-context

This changed error to:

Exception thrown when executing UIFrameGuarded
ViewManagerResolver returned null for either RNSScreen or RCTRNSScreen, existing names are: [RNCSafeAreaProvider, DebuggingOverlay, RNGestureHandlerButton, RCTSafeAreaView, RCTModalHostView, RCTTextInlinelmage, Android ProgressBar, AndroidHorizontalScrollView, RCTImageView, RCTText, Android HorizontalScrollContentView, UnimplementedNativeView, RTCVideoView, RCTScrollView, RNCSafeArea View, RCTView, AndroidDrawerLayout, AndroidSwitch, RCTVirtualText, AndroidSwipeRefreshLayout, RCTRawText, AndroidTextInput,
RNGestureHandlerRootView]

Why did this happen?
React Navigation and other libraries require react-native-screens for navigation performance and correct behavior.
If it’s missing, you get this error and your app may crash or not render correctly.

to install:
npx expo install react-native-screens

FINALLY IT RUNS!!!

Ok lets now add CallScreen and permissions files
From CallScreen we are missing:
react-native-incall-manager
react-native-modal

From permissions we are missing:
react-native-permissions

Both files have been changed to .jsx
install dependencies using:
npx expo install react-native-incall-manager react-native-modal react-native-permissions

(Wrong Way)Since we are using a bare install of Expo (Not using Expo Go)
We must also install Cocoa Pods to make react-native-permissions work:
npx pod-install

Make sure you have run npx pod-install after installing react-native-permissions.
Make sure your android/app/src/main/AndroidManifest.xml and ios/Info.plist have the correct permissions.
Make sure you are not mixing Expo managed and bare permissions APIs.

Ok so cocoa pods didn't install cuz I don't have a mac, what I actually needed to do was add iOS permissions as a child of react-native-permissions in the config:

```
"plugins": [
      "@config-plugins/react-native-webrtc",
      [
        "react-native-permissions",
        {
          "iosPermissions": [
            "CAMERA",
            "MICROPHONE"
          ]
        }
      ]
    ]
```
